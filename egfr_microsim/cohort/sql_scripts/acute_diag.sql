DECLARE icd9 ARRAY <STRING>;
DECLARE icd10 ARRAY <STRING>;
DECLARE snomed ARRAY <STRING>;

SET icd9 = ['584', '584.5', '584.6', '584.7', '584.8', '584.9', '669.3', '669.30', '669.32', '669.34', '788.99', '670.20', '670.22', '670.24', '771.81', '995.9', '995.90', '995.91', '995.92', '995.93', '995.94', '276.5', '276.50', '276.51', '276.52', '634.5', '634.50', '634.51', '634.52', '635.5', '635.50', '635.51', '635.52', '636.5', '636.50', '636.51', '636.52', '637.5', '637.50', '637.51', '637.52', '638.5', '639.5', '669.1', '669.10', '669.11', '669.12', '669.13', '669.14', '785.5', '785.50', '785.51', '785.52', '785.59', '958.4', '995.4', '995.6', '995.60', '995.61', '995.62', '995.63', '995.64', '995.65', '995.66', '995.67', '995.68', '995.69', '998.0', '998.00', '998.01', '998.02', '998.09', '998.1', '998.11', '998.5', '998.51', '998.59', '998.7', '999.4', '999.41', '999.42', '999.49', 'E879.3'];
SET icd10 = ['N17.0', 'N17.1', 'N17.2', 'N17.8', 'N17.9', 'O90.4', 'O90.4', 'R39.2', 'A02.1', 'A22.7', 'A26.7', 'A32.7', 'A40.0', 'A40.1', 'A40.3', 'A40.8', 'A40.9', 'A41.01', 'A41.02', 'A41.1', 'A41.2', 'A41.3', 'A41.4', 'A41.50', 'A41.51', 'A41.52', 'A41.53', 'A41.59', 'A41.81', 'A41.89', 'A41.9', 'A42.7', 'A54.86', 'B37.7', 'O85', 'O85', 'P36.0', 'P36.10', 'P36.19', 'P36.2', 'P36.30', 'P36.39', 'P36.4', 'P36.5', 'P36.8', 'P36.9', 'R65.10', 'R65.11', 'R65.20', 'R65.21', 'E86.0', 'E86.1', 'E86.9', 'D78.01', 'D78.01', 'D78.02', 'D78.02', 'D78.11', 'D78.12', 'D78.21', 'D78.21', 'D78.22', 'D78.22', 'E36.01', 'E36.01', 'E36.02', 'E36.02', 'E36.11', 'E36.12', 'G97.31', 'G97.31', 'G97.32', 'G97.32', 'G97.48', 'G97.49', 'G97.51', 'G97.51', 'G97.52', 'G97.52', 'I97.410', 'I97.410', 'I97.411', 'I97.411', 'I97.418', 'I97.418', 'I97.42', 'I97.42', 'I97.51', 'I97.52', 'I97.610', 'I97.610', 'I97.611', 'I97.611', 'I97.618', 'I97.618', 'I97.62', 'I97.62', 'J95.61', 'J95.61', 'J95.62', 'J95.62', 'J95.71', 'J95.72', 'J95.830', 'J95.830', 'J95.831', 'J95.831', 'K68.11', 'K91.61', 'K91.61', 'K91.62', 'K91.62', 'K91.71', 'K91.72', 'K91.840', 'K91.840', 'K91.841', 'K91.841', 'L76.01', 'L76.01', 'L76.02', 'L76.02', 'L76.11', 'L76.12', 'L76.21', 'L76.21', 'L76.22', 'L76.22', 'L76.81', 'L76.82', 'M96.810', 'M96.810', 'M96.811', 'M96.811', 'M96.820', 'M96.821', 'M96.830', 'M96.830', 'M96.831', 'M96.831', 'N99.61', 'N99.61', 'N99.62', 'N99.62', 'N99.71', 'N99.72', 'N99.820', 'N99.820', 'N99.821', 'N99.821', 'O03.31', 'O03.81', 'O03.81', 'O04.81', 'O07.31', 'O08.3', 'O75.1', 'O75.1', 'O75.1', 'R57.0', 'R57.1', 'R57.8', 'R57.9', 'R65.21', 'T78.00XA', 'T78.01XA', 'T78.02XA', 'T78.03XA', 'T78.04XA', 'T78.05XA', 'T78.06XA', 'T78.07XA', 'T78.08XA', 'T78.09XA', 'T79.4XXA', 'T80.51XA', 'T80.52XA', 'T80.59XA', 'T81.10XA', 'T81.11XA', 'T81.12XA', 'T81.19XA', 'T81.4XXA', 'T88.2XXA', 'Y84.3'];
SET snomed = ['1048451000000103', '1048481000000109', '1048491000000106', '1048501000000100', '1048511000000103', '1048521000000109', '1048541000000102', '111407006', '129721000119106', '13010001', '140031000119103', '145681000119101', '14669001', '17380002', '200117009', '200118004', '213231008', '22846003', '236426006', '236427002', '236428007', '236429004', '236431008', '236432001', '23697004', '269257004', '298015003', '301814009', '307309005', '31005002', '35455006', '36225005', '36568005', '368951000119105', '373421000', '373422007', '422593004', '423533009', '429224003', '429489008', '430535006', '444976001', '51292008', '62216007', '71909003', '78209002', '840371000000100', '840431000000109', '840451000000102', '840471000000106', '841961000000100', '842511000000101', '842531000000109', '842551000000102', '844631000000104', '844701000000103', '844741000000100', '847851000000101', '851931000000107', '851941000000103', '851951000000100', '10001005', '1036671000000106', '10751351000119104', '10812001000119100', '1089000', '1125006', '127091000119100', '17732003', '186365005', '18700001', '194394004', '195284000', '196111003', '196853004', '198462004', '199710008', '199711007', '200196001', '206376005', '206378006', '206379003', '206380000', '238149007', '240385003', '240389009', '240426001', '24444009', '25042006', '272006008', '276288002', '276669000', '276678006', '2858002', '300985007', '300986008', '310649002', '310669007', '32751000119100', '371044001', '371093006', '400661000000104', '402961006', '403000003', '404174000', '4089001', '41936006', '429272002', '42939002', '43424001', '43641000119102', '441596002', '443980004', '447684006', '447685007', '447841007', '447843005', '447894003', '447897005', '447898000', '447899008', '448417001', '448418006', '448419003', '448420009', '448421008', '448422001', '448482003', '448483008', '448784003', '448812000', '448813005', '449082003', '449083008', '449084002', '449335002', '449504009', '449505005', '449546000', '465311000000103', '46848006', '5085001', '51831006', '5567000', '61145000', '67465009', '698819004', '700049004', '700050004', '700051000', '700052007', '700053002', '700054008', '700055009', '707271004', '713854001', '713865006', '713866007', '714083007', '715070000', '715071001', '750511000000101', '77206006', '79587009', '823021000000109', '823031000000106', '823041000000102', '823051000000104', '8554002', '9012003', '91302008', '944061000000108', '944071000000101', '957421000000104', '957431000000102', '112421000119102', '1601000119105', '1611000119108', '162685008', '190894003', '212971003', '234178003', '234179006', '28560003', '34095006', '427784006', '44759006', '450316000', '47417003', '54480007', '78812008', '87571007', '10751391000119109', '10762261000119105', '1092471000119105', '1092481000119108', '1092491000119106', '1092501000119104', '1092511000119101', '1092531000119106', '1092541000119102', '110265006', '11669000', '127141000119107', '127171000119100', '127181000119102', '127191000119104', '127201000119101', '127231000119108', '127241000119104', '127251000119102', '127261000119100', '127411000119102', '127421000119109', '128381000119104', '129577007', '12983003', '15765005', '16217003', '16574001', '18504008', '18613002', '193069004', '194883006', '198649006', '198661003', '200105007', '200106008', '200107004', '200108009', '213255003', '213256002', '213258001', '213261000', '213320003', '234173007', '234174001', '234240008', '234241007', '234242000', '234243005', '236426006', '236724008', '236725009', '236726005', '240450004', '240451000', '24051007', '241933001', '241934007', '241935008', '241936009', '241943003', '241944009', '241951000', '24841007', '25042006', '275414004', '276227005', '27942005', '308895003', '308896002', '308897006', '308898001', '309784007', '309785008', '310643001', '311792005', '311793000', '311796008', '34270000', '355001', '361206004', '36225005', '363286005', '363339009', '369061000119104', '371769008', '39419009', '427833000', '427903006', '428795003', '429268001', '429751004', '441492003', '441495001', '442052005', '460358000', '460490009', '461416009', '461429009', '473440005', '473441009', '47537002', '51831006', '58581001', '62657007', '64169002', '69344006', '698504006', '703179007', '703189006', '703190002', '703191003', '703200003', '70993000', '715887004', '716050002', '718447001', '72481000119103', '72813006', '73301000', '76571007', '78240009', '78340007', '78643003', '78717006', '79315005', '79325000', '79337003', '82545002', '83043008', '83250000', '83722004', '84007008', '86152005', '87043009', '88969002', '89138009', '89486006', '8961006', '89819002', '90191000119100', '91941002', '963681000000101', '963721000000108', '963731000000105'];

CREATE OR REPLACE TABLE {destination_dataset}.acute_diag AS (
    WITH omop_concepts AS (
        SELECT 
            concept_id, concept_name, vocabulary_id
        FROM
            {source_dataset}.concept
        WHERE 
            concept_code IN UNNEST(icd9) AND vocabulary_id = 'ICD9CM'
            OR concept_code IN UNNEST(icd10) AND vocabulary_id = 'ICD10CM'
            OR concept_code IN UNNEST(snomed) AND vocabulary_id = 'SNOMED'
    )

    SELECT 
        a.*,
        b.concept_name,
        b.vocabulary_id
    FROM {source_dataset}.condition_occurrence AS a
    INNER JOIN omop_concepts AS b
    ON a.condition_concept_id=b.concept_id
)


 